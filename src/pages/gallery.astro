---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get blog posts to match with gallery images
const allPosts = await getCollection('blog');

let galleryItems: Array<{
  id: string;
  title: string;
  author: string;
  publisher?: string;
  description: string;
  imagePath: string;
  tags: string[];
}> = [];

// Get gallery items from blog posts that have origami images
// 折った本のみを対象とする
for (const post of allPosts) {
  if (post.data.images?.origami && !post.data.title.includes('を折らない')) {
    const origamiImages = Array.isArray(post.data.images.origami) 
      ? post.data.images.origami 
      : [post.data.images.origami];
    
    if (origamiImages.length > 0) {
      galleryItems.push({
        id: post.data.id || post.slug,
        title: post.data.title,
        author: post.data.author,
        publisher: post.data.publisher,
        description: post.data.description,
        imagePath: origamiImages[0], // 最初の折り紙画像を使用
        tags: post.data.tags || []
      });
    }
  }
}

// Sort by ID (newest first)
galleryItems.sort((a, b) => parseInt(b.id) - parseInt(a.id));

// Gallery page for displaying origami works
---

<Layout title="Gallery - Paper After Word" currentPage="gallery">

    <div class="page-header">
      <h1>Gallery</h1>
      <p>本を読んで、読んだ本を折り紙にする。</p>
    </div>

    <main class="content">
      {galleryItems.length > 0 ? (
        <div class="gallery-container">
          <section class="gallery-section">
            <div class="gallery-grid">
              {galleryItems.map((item) => (
                <div class="gallery-item">
                  <a href={`/blog/${item.id}`} class="gallery-link">
                    <img src={item.imagePath} alt={`${item.title}の折り紙作品`} class="gallery-image" />
                  </a>
                </div>
              ))}
            </div>
          </section>
        </div>
      ) : (
        <div class="coming-soon">
          <h2>準備中</h2>
          <p>折り紙作品のギャラリーは準備中です。<br>近日中に公開予定です。</p>
        </div>
      )}
    </main>
  </Layout>

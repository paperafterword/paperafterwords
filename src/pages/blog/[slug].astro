---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.data.id || post.slug },
    props: post,
  }));
}

const post = Astro.props as any;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} - Paper After Word`} currentPage="blog">
  <div class="back">
    <a href="/">← 一覧に戻る</a>
  </div>

  <main class="content-page">
    <article class="content-text">
        <header>
          <h1>{post.data.title}</h1>
          <div class="meta">
            <p>{post.data.author}
            {post.data.translator && <span>（訳：{post.data.translator}）</span>}</p>
            {post.data.publisher && (
              <div class="book-info">
                <p><strong>{post.data.publisher}</strong></p>
              </div>
            )}
          </div>
        </header>
        
        <p><strong>{post.data.description}</strong></p>

        <div class="images">
          {post.data.images?.bookCover && (
            <div class="book-cover">
              <img src={post.data.images.bookCover} alt="本の表紙" loading="lazy" decoding="async" />
            </div>
          )}
          {post.data.images?.origami && (
            <div class="origami-work">
              <img src={post.data.images.origami} alt="折り紙作品" loading="lazy" decoding="async" />
            </div>
          )}
        </div>

        <Content />

        {post.data.amazonUrl && (
          <p class="amazon-link">
            <a href={post.data.amazonUrl} target="_blank" rel="noopener noreferrer">{post.data.title.replace('を折らない', '').replace('を折る', '')}をAmazonで購入</a>
          </p>
        )}
    </article>
  </main>
</Layout>

<style>
  .amazon-link {
    margin-top: 50px;
  }
</style>

---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.data.id || post.slug },
    props: post,
  }));
}

const post = Astro.props as any;
const { Content } = await post.render();
---

<Layout title={`${post.data.title} - Paper After Word`} currentPage="blog">
  <div class="back">
    <a href="/">← 一覧に戻る</a>
  </div>

  <main class="content-page">
    <article class="content-text">
        <header>
          <h1>{post.data.title}</h1>
          <div class="meta">
            <p>{post.data.author} · {new Date(post.data.date).toLocaleDateString('ja-JP')}</p>
            {post.data.publisher && (
              <div class="book-info">
                <p><strong>{post.data.publisher}</strong></p>
                {post.data.translator && <p>訳：{post.data.translator}</p>}
                {post.data.publishDate && <p>発売日：{post.data.publishDate}</p>}
              </div>
            )}
          </div>
        </header>
        
        <p><strong>{post.data.description}</strong></p>

        <div class="images">
          <div class="book-cover">
            <img src={post.data.coverImage || "/images/default/no-cover.svg"} alt="本の表紙" />
          </div>
          {post.data.origamiImage && (
            <div class="origami-work">
              <img src={post.data.origamiImage} alt="折り紙作品" />
            </div>
          )}
        </div>

        <Content />
    </article>
  </main>
</Layout>
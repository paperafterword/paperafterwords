---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allPosts = await getCollection('blog');

// フィーチャード記事のIDを指定（順番通りに表示）
const featuredPostIds = ['006', '004', '005', '002','001']; 

// フィーチャード記事を指定された順番で取得
const posts = featuredPostIds.map(id => 
  allPosts.find(post => post.data.id === id)
).filter(Boolean); // undefinedを除外

// Gallery用の折り紙作品を取得
let galleryItems: Array<{
  id: string;
  title: string;
  author: string;
  publisher?: string;
  description: string;
  imagePath: string;
  tags: string[];
}> = [];

// 折り紙作品がある投稿のみを対象とする
for (const post of allPosts) {
  if (post.data.images?.origami && !post.data.title.includes('を折らない')) {
    galleryItems.push({
      id: post.data.id || post.slug,
      title: post.data.title,
      author: post.data.author,
      publisher: post.data.publisher,
      description: post.data.description,
      imagePath: post.data.images.origami,
      tags: post.data.tags || []
    });
  }
}

// ID順でソート（新しい順）
galleryItems.sort((a, b) => parseInt(b.id) - parseInt(a.id));
---

<Layout title="Paper After Word" currentPage="top">

  <div class="page-header">
    <h1>Paper After Word</h1>
    <p>本を読んで、読んだ本を折り紙にする。</p>
  </div>

    <main class="content">
        <figure class="camera-photo-container">
          <img src="/assets/zatto.png" alt="雑踏" class="camera-photo" />
          <figcaption class="photo-caption">
            « Fais ce que voudras.» 汝の欲するところを為せ
            <span class="quote-author">— フランソワ・ラブレー</span>
          </figcaption>
        </figure>
      <div class="intro">
        <p>本というものは、読み終えた後、ただ棚に並べておくばかりでは、どうにもその余情が空に散ってしまうように思われる。<br />
          折り紙が好きで、せっかく紙がそこにあるのなら...
        </p>
        <p>そこに積み重なった紙の山を、静かに別の姿へと折り変えてみたくなる。文字はすでに胸の裡に沈み込み、その用を終えた紙は、今や形そのもののために在る。</p>
        <p>ここでは、読み終えた本の紙を折り紙にし、本の感想と合わせてその記録を残す。<br />
          意味があるかどうかはわからないが、手を動かしていると、そのこと自体が少しおもしろい。</p>
        
          <a href="/story" class="more-posts-link">
            あらすじを読む
          </a>
      </div>


      <h2 id="blog" class="section-title">作品一覧</h2>      
      <div class="posts">
        {posts.map((post) => (
          <article class="post">
            <div class="post-content">
              <h3><a href={`/blog/${post.data.id || post.slug}`}>{post.data.title}</a></h3>
              <div class="meta">
                <span class="author-info">
                  {post.data.author}
                  {post.data.translator && <span>（訳：{post.data.translator}）</span>}
                  {post.data.publisher && <span class="publisher"> / {post.data.publisher}</span>}
                </span>
              </div>
              <p><a href={`/blog/${post.data.id || post.slug}`}>{post.data.description}</a></p>
            </div>
            {post.data.images?.bookCover && (
              <div class="post-images">
                <a href={`/blog/${post.data.id || post.slug}`}>
                  <img src={post.data.images.bookCover} alt={post.data.title} loading="lazy" decoding="async" />
                </a>
              </div>
            )}
          </article>
        ))}
      </div>
      
      <!-- 他の作品を見るリンク -->
      {allPosts.length > 5 && (
        <div class="more-posts">
          <a href="/blog" class="more-posts-link">
            他の作品を見る
          </a>
        </div>
      )}
      
      <section id="gallery" class="section">
        <h2>Gallery</h2>
        {galleryItems.length > 0 ? (
          <div class="gallery-container">
            <div class="gallery-grid">
              {galleryItems.map((item) => (
                <div class="gallery-item">
                  <a href={`/blog/${item.id}`} class="gallery-link">
                    <img src={item.imagePath} alt={`${item.title}の折り紙作品`} class="gallery-image" />
                  </a>
                </div>
              ))}
            </div>
          </div>
        ) : (
          <p class="section-text">折り紙作品のギャラリーは準備中です。</p>
        )}
      </section>
      
      <section id="shop" class="section">
        <h2>Shop</h2>
        <p class="section-text">オンラインショップは準備中です。</p>
      </section>
      
      <section id="sns" class="section">
        <h2>SNS</h2>
        <div class="sns-links">
          <a href="https://twitter.com/paperafterword" target="_blank" rel="noopener noreferrer" class="sns-link">
            <span class="sns-icon">𝕏</span>
          </a>
          <a href="https://jp.pinterest.com/paperafterword/" target="_blank" rel="noopener noreferrer" class="sns-link">
            <img src="/assets/pinterest.png" alt="Pinterest" class="sns-icon">
          </a>
        </div>
      </section>
</Layout>